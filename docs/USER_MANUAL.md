# MeDF Hub - ユーザーマニュアル

**バージョン**: 1.0  
**対象ユーザー**: 一般ユーザー・研究者・ドキュメント作成者  
**最終更新**: 2026年2月8日

---

## 目次

1. [クイックスタート](#クイックスタート)
2. [基本操作](#基本操作)
3. [文書の作成と管理](#文書の作成と管理)
4. [議論とコメント](#議論とコメント)
5. [IPFS公開](#ipfs公開)
6. [エクスポート](#エクスポート)
7. [よくある質問](#よくある質問)

---

## クイックスタート

### 1. ログイン

ホームページの「ログイン」ボタンをクリックし、Manus OAuth認証を完了してください。初回ログイン時は自動的にユーザープロフィールが作成されます。

### 2. 文書を作成する

**方法A: Markdownから作成（推奨）**

1. トップナビゲーションの「新規作成」をクリック
2. 「Markdownを変換」を選択
3. Markdown形式で文書を入力
4. 「変換」ボタンをクリック
5. 確認画面で「保存」をクリック

**方法B: MeDF JSONから作成**

1. 「新規作成」→「文書を作成」を選択
2. MeDF JSON形式の文書をアップロード
3. 「保存」をクリック

### 3. 文書を検索・閲覧する

1. トップナビゲーションの「文書一覧」をクリック
2. タイトル・ID・発行者で検索
3. 文書をクリックして詳細表示

### 4. コメントを投稿する

1. 文書詳細ページで、コメントしたいブロックまでスクロール
2. 「コメント」セクションの入力欄にテキストを入力
3. 「送信」ボタンをクリック

### 5. 文書をIPFSに公開する

1. 文書詳細ページの「IPFS」ボタンをクリック
2. 公開確認ダイアログで「公開」をクリック
3. 公開後、CIDとゲートウェイリンクが表示されます

---

## 基本操作

### ホームページ

ホームページでは、MeDF Hubの概要と主な機能が紹介されています。以下のボタンから各機能にアクセスできます。

| ボタン | 説明 |
|-------|------|
| 文書を閲覧 | 既存の文書一覧を表示 |
| Markdownを変換 | Markdown形式の文書をMeDF形式に変換 |

### トップナビゲーション

| メニュー | 説明 |
|---------|------|
| MeDF Hub | ホームページへ戻る |
| 文書一覧 | すべての文書を検索・閲覧 |
| 新規作成 | 新しい文書を作成 |
| MD変換 | Markdownを変換 |
| ユーザーメニュー | ログアウト |

### ユーザーメニュー

ページ右上のユーザーアイコンをクリックすると、以下のメニューが表示されます。

- **プロフィール**: ユーザー情報を表示（今後実装予定）
- **ログアウト**: セッションを終了

---

## 文書の作成と管理

### Markdownから文書を作成

**対応形式**: GitHub Flavored Markdown

**ブロック分割ルール**: `##` レベルのヘッダーでブロックを分割

```markdown
# 文書タイトル

## ブロック1: Introduction

このセクションが最初のブロックになります。

## ブロック2: Methodology

このセクションが2番目のブロックになります。

## ブロック3: Conclusion

このセクションが3番目のブロックになります。
```

**入力フィールド**:

| フィールド | 説明 | 必須 |
|-----------|------|------|
| Markdown | 文書本文 | ○ |
| 文書ID | 自動生成（タイトルから）またはカスタム指定 | - |
| 発行者 | 文書の作成者名 | - |

**生成される情報**:

- **ブロックID**: ヘッダーテキストから自動生成（例: `introduction`）
- **ブロックハッシュ**: 各ブロックの内容から SHA-256 で計算
- **ドキュメントハッシュ**: 全ブロックから SHA-256 で計算
- **IPFS CID**: ドキュメントハッシュから生成

### 文書を編集する

1. 文書詳細ページの「編集」ボタンをクリック
2. MeDF JSON形式で編集
3. 「保存」をクリック

**注意**: 編集時に前のバージョンが自動保存されます。「履歴」タブから復元できます。

### 文書を削除する

1. 文書詳細ページの「削除」ボタンをクリック（所有者のみ）
2. 確認ダイアログで「削除」をクリック

**警告**: 削除は取り消せません。関連するコメント・バージョンもすべて削除されます。

### バージョン管理

#### 履歴を表示する

1. 文書詳細ページの「履歴」タブをクリック
2. バージョン一覧が表示されます

#### 差分を確認する

1. 「履歴」タブで、比較したいバージョンを選択
2. 差分がブロック単位で表示されます

**色分け**:

- 🟢 **緑**: 追加されたブロック
- 🔴 **赤**: 削除されたブロック
- 🟡 **黄**: 変更されたブロック

#### 前のバージョンに戻す

1. 「履歴」タブで、復元したいバージョンを選択
2. 「ロールバック」ボタンをクリック
3. 確認ダイアログで「実行」をクリック

**注意**: ロールバック時に現在のバージョンが新しいバージョンとして保存されます。

---

## 議論とコメント

### コメントを投稿する

#### ブロック単位のコメント

1. 文書詳細ページで、コメントしたいブロックを見つけます
2. ブロック下部の「コメント」セクションをスクロール
3. テキストボックスにコメントを入力
4. 「送信」ボタンをクリック

#### 引用付きコメント

コメント内で他の文書を参照する場合、以下の形式を使用してください。

```
MEDF: {文書ID}#{ブロックID}
```

**例**:

```
この内容は MEDF: paper-2026-example#methodology で詳しく説明されています。
```

### コメントに返信する

1. 既存のコメントの「返信」ボタンをクリック
2. 返信テキストを入力
3. 「送信」をクリック

**表示**: 返信は親コメントの下にインデント付きで表示されます。

### コメントを削除する

1. 自分が投稿したコメントの「削除」ボタンをクリック
2. 確認ダイアログで「削除」をクリック

**注意**: 削除できるのは自分が投稿したコメントのみです。

### 参照トラッキング

コメント内で `MEDF: doc-id#block-id` 形式の引用を使用すると、自動的にリンク化されます。

**参照の表示**:

1. 文書詳細ページの「参照」タブをクリック
2. **参照先**: この文書が参照している他の文書
3. **参照元**: この文書を参照している他の文書

---

## IPFS公開

### 文書をIPFSに公開する

1. 文書詳細ページの「IPFS」ボタンをクリック
2. 公開確認ダイアログが表示されます
3. 「公開」をクリック

**処理内容**:

- Pinata APIキーが設定されている場合: 実際のIPFSネットワークにピン
- APIキー未設定の場合: シミュレーション（ローカル計算）

### 公開後の表示

公開成功後、以下の情報が表示されます。

| 情報 | 説明 |
|-----|------|
| CID | Content Identifier（IPFS上の一意識別子） |
| ipfs.io | IPFS.io ゲートウェイへのリンク |
| Pinata Gateway | Pinata ゲートウェイへのリンク |

### ゲートウェイでアクセスする

表示されたリンクをクリックすると、IPFS上の文書にアクセスできます。

**ゲートウェイの特徴**:

- 中央集約的なサーバーを経由してIPFSコンテンツにアクセス
- ブラウザから直接アクセス可能
- ネットワーク障害時は利用不可

### ピンを解除する

1. 文書詳細ページの「IPFS」セクションで「ピン解除」をクリック
2. 確認ダイアログで「実行」をクリック

**注意**: ピン解除後、ゲートウェイからアクセスできなくなる可能性があります。

---

## エクスポート

### HTML形式でエクスポート

1. 文書詳細ページの「HTML」ボタンをクリック
2. ブラウザのダウンロード機能で HTML ファイルが保存されます

**含まれる内容**:

- 文書メタデータ（タイトル・発行者・作成日）
- 目次（TOC）
- ブロック本文（Markdown → HTML変換済み）
- ブロックハッシュ
- 参照リンク

### PDF形式でエクスポート

1. 文書詳細ページの「PDF」ボタンをクリック
2. ブラウザの印刷ダイアログが開きます
3. 「PDFに保存」を選択して保存

**ダイアログのオプション**:

- **用紙サイズ**: A4 推奨
- **余白**: デフォルト
- **背景グラフィックス**: 有効（推奨）

### JSON形式でダウンロード

1. 文書詳細ページの「JSON」ボタンをクリック
2. MeDF JSON形式のファイルがダウンロードされます

**用途**: 他のシステムへのインポート、バックアップ

---

## よくある質問

### Q1: ブロックIDはどのように決まりますか？

**A**: ブロックIDは `##` レベルのヘッダーテキストから自動生成されます。テキストは小文字に変換され、スペースはハイフンに置き換わります。

**例**:

```markdown
## Introduction to MeDF
```

↓

```
block_id: "introduction-to-medf"
```

### Q2: ハッシュが一致しないのはなぜですか？

**A**: 以下の原因が考えられます。

1. **JSON正規化**: RFC 8785 準拠の正規化が必要です。スペース・改行・キーの順序が異なるとハッシュが変わります。
2. **文字エンコーディング**: UTF-8 で統一してください。
3. **ブロックハッシュ**: 各ブロックのハッシュが正しく計算されているか確認してください。

### Q3: オフラインで検証できますか？

**A**: はい。クライアント側で Web Crypto API を使用して検証しているため、オフラインでも可能です。ただし、参照トラッキングなど一部の機能はオンライン時のみ利用可能です。

### Q4: Pinata APIキーはどこで取得しますか？

**A**: [Pinata Cloud](https://www.pinata.cloud/) にアカウント登録し、API キーを生成してください。詳細は Pinata の公式ドキュメントを参照してください。

### Q5: コメントは削除できますか？

**A**: はい。自分が投稿したコメントは削除できます。ただし、返信がある場合、親コメントの削除は返信に影響を与えます。

### Q6: 文書の所有権を譲渡できますか？

**A**: 現在のバージョンでは所有権の譲渡機能はありません。今後のアップデートで実装予定です。

### Q7: 複数の言語に対応していますか？

**A**: 現在は日本語と英語のUIに対応しています。文書本文は任意の言語で作成できます。

### Q8: 大きなファイルをアップロードできますか？

**A**: MeDF JSON形式のアップロードは 10MB 以下を推奨します。Markdown 形式の場合、テキストサイズに制限はありません。

### Q9: バックアップはできますか？

**A**: はい。「JSON」ボタンで MeDF JSON をダウンロードしてバックアップしてください。定期的なバックアップを推奨します。

### Q10: 通知を受け取るにはどうしますか？

**A**: オーナー（文書作成者）は、コメント投稿・文書更新時に自動的に通知を受け取ります。通知設定の詳細は、今後のアップデートで提供予定です。

---

## トラブルシューティング

### ログインできない

- ブラウザのクッキーが有効になっているか確認してください
- プライベートブラウジングモードを使用している場合は、通常モードで試してください
- キャッシュをクリアしてから再度ログインしてください

### 文書が保存されない

- ネットワーク接続を確認してください
- ブラウザのコンソール（F12）でエラーメッセージを確認してください
- 入力値が正しい形式か確認してください

### ハッシュが検証できない

- ブロック内容に改行やスペースが含まれていないか確認してください
- JSON形式が RFC 8785 に準拠しているか確認してください
- ブラウザの Web Crypto API が有効になっているか確認してください

### IPFSに公開できない

- Pinata APIキーが正しく設定されているか確認してください
- Pinata アカウントの容量制限に達していないか確認してください
- ネットワーク接続を確認してください

---

## サポート

問題が発生した場合は、以下の方法でサポートを受けることができます。

- **バグ報告**: GitHub Issues で報告してください
- **機能リクエスト**: GitHub Discussions で提案してください
- **その他**: オーナー通知機能を使用してお問い合わせください

---

**作成者**: Manus AI  
**ライセンス**: MIT  
**最終更新**: 2026年2月8日
